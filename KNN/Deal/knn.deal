%Facts
train(1,1,1317.265789).
train(1,2,1315.220951).
train(1,3,1312.770581).
train(1,4,1309.834252).
train(1,5,1306.315588).
train(1,6,1302.099102).
train(1,7,1297.046401).
train(1,8,1290.991646).
train(1,9,1283.736109).
train(1,10,1275.041652).
train(1,11,1264.622905).
train(1,12,1252.137909).
train(1,13,1237.176883).
train(1,14,1219.248779).
train(1,15,1197.765167).
train(1,16,1172.020916).
train(1,17,1141.171054).
train(1,18,1104.203034).
train(1,19,1059.903502).
train(1,20,1006.818467).
train(1,21,943.2055856).
train(1,22,866.976971).
train(1,23,943.2055856).
train(1,24,1006.818467).
train(1,25,1059.903502).
train(1,26,1104.203034).
train(1,27,1141.171054).
train(1,28,1172.020916).
train(1,29,1197.765167).
train(1,30,1219.248779).
train(2,1,7329.967624).
train(2,2,7379.907443).
train(2,3,7441.799231).
train(2,4,7518.503422).
train(2,5,7613.565031).
train(2,6,7731.377492).
train(2,7,7877.385707).
train(2,8,8058.337694).
train(2,9,8282.596458).
train(2,10,8560.526497).
train(2,11,8904.972822).
train(2,12,9331.854603).
train(2,13,9860.900909).
train(2,14,10516.56251).
train(2,15,9860.900909).
train(2,16,9331.854603).
train(2,17,8904.972822).
train(2,18,8560.526497).
train(2,19,8282.596458).
train(2,20,8058.337694).
train(2,21,7877.385707).
train(2,22,7731.377492).
train(2,23,7613.565031).
train(2,24,7518.503422).
train(2,25,7441.799231).
train(2,26,7379.907443).
train(2,27,7329.967624).
train(2,28,7289.671721).
train(2,29,7257.157389).
train(2,30,7230.921924).
train(3,1,809.4214096).
train(3,2,809.7801194).
train(3,3,810.2071911).
train(3,4,810.7156529).
train(3,5,811.321016).
train(3,6,812.0417476).
train(3,7,812.8998341).
train(3,8,813.9214524).
train(3,9,815.137768).
train(3,10,816.5858856).
train(3,11,818.3099814).
train(3,12,820.3626507).
train(3,13,822.806512).
train(3,14,825.7161177).
train(3,15,829.180228).
train(3,16,833.3045189).
train(3,17,838.2148058).
train(3,18,844.0608816).
train(3,19,851.0210865).
train(3,20,859.307748).
train(3,21,869.1736586).
train(3,22,880.9197872).
train(3,23,894.9044607).
train(3,24,911.5542946).
train(3,25,931.377208).
train(3,26,954.9779177).
train(3,27,983.0763854).
train(3,28,1016.529782).
train(3,29,1056.358634).
train(3,30,1103.777959).
train(4,1,45334.20888).
train(4,2,45334.21356).
train(4,3,45334.21906).
train(4,4,45334.2255).
train(4,5,45334.23305).
train(4,6,45334.24191).
train(4,7,45334.2523).
train(4,8,45334.26448).
train(4,9,45334.27876).
train(4,10,45334.29552).
train(4,11,45334.31516).
train(4,12,45334.3382).
train(4,13,45334.36522).
train(4,14,45334.3969).
train(4,15,45334.43406).
train(4,16,45334.47763).
train(4,17,45334.52873).
train(4,18,45334.58866).
train(4,19,45334.65893).
train(4,20,45334.74134).
train(4,21,45334.83798).
train(4,22,45334.95132).
train(4,23,45335.08422).
train(4,24,45335.24008).
train(4,25,45335.42286).
train(4,26,45335.63721).
train(4,27,45335.88857).
train(4,28,45336.18335).
train(4,29,45336.52904).
train(4,30,45336.93443).
train(5,1,1.810359264).
train(5,2,1.810359264).
train(5,3,1.810359264).
train(5,4,1.810359264).
train(5,5,1.810359264).
train(5,6,1.810359264).
train(5,7,1.810359263).
train(5,8,1.810359263).
train(5,9,1.810359263).
train(5,10,1.810359263).
train(5,11,1.810359262).
train(5,12,1.810359261).
train(5,13,1.810359261).
train(5,14,1.81035926).
train(5,15,1.810359258).
train(5,16,1.810359257).
train(5,17,1.810359254).
train(5,18,1.810359251).
train(5,19,1.810359248).
train(5,20,1.810359243).
train(5,21,1.810359237).
train(5,22,1.810359229).
train(5,23,1.810359219).
train(5,24,1.810359206).
train(5,25,1.810359189).
train(5,26,1.810359167).
train(5,27,1.810359138).
train(5,28,1.810359102).
train(5,29,1.810359055).
train(5,30,1.810358994).
train(6,1,2.073516558).
train(6,2,2.073546054).
train(6,3,2.073581005).
train(6,4,2.073622421).
train(6,5,2.073671497).
train(6,6,2.07372965).
train(6,7,2.073798559).
train(6,8,2.073880214).
train(6,9,2.073976971).
train(6,10,2.074091625).
train(6,11,2.074227485).
train(6,12,2.074388473).
train(6,13,2.074579238).
train(6,14,2.074805287).
train(6,15,2.075073146).
train(6,16,2.075390547).
train(6,17,2.075766655).
train(6,18,2.076212328).
train(6,19,2.076740432).
train(6,20,2.077366215).
train(6,21,2.078107742).
train(6,22,2.078986421).
train(6,23,2.08002762).
train(6,24,2.0812614).
train(6,25,2.082723378).
train(6,26,2.084455764).
train(6,27,2.086508571).
train(6,28,2.088941065).
train(6,29,2.091823471).
train(6,30,2.095239007).
train(7,1,382.1351041).
train(7,2,382.1351064).
train(7,3,382.1351093).
train(7,4,382.1351129).
train(7,5,382.1351173).
train(7,6,382.1351227).
train(7,7,382.1351295).
train(7,8,382.1351379).
train(7,9,382.1351482).
train(7,10,382.1351611).
train(7,11,382.135177).
train(7,12,382.1351967).
train(7,13,382.135221).
train(7,14,382.1352512).
train(7,15,382.1352886).
train(7,16,382.1353348).
train(7,17,382.1353921).
train(7,18,382.135463).
train(7,19,382.1355509).
train(7,20,382.1356596).
train(7,21,382.1357943).
train(7,22,382.135961).
train(7,23,382.1361675).
train(7,24,382.1364231).
train(7,25,382.1367397).
train(7,26,382.1371316).
train(7,27,382.1376169).
train(7,28,382.1382179).
train(7,29,382.138962).
train(7,30,382.1398833).
train(8,1,1400.189621).
train(8,2,1403.099806).
train(8,3,1406.539028).
train(8,4,1410.603461).
train(8,5,1415.406761).
train(8,6,1421.083247).
train(8,7,1427.791651).
train(8,8,1435.719567).
train(8,9,1445.088686).
train(8,10,1456.161004).
train(8,11,1469.246141).
train(8,12,1484.710006).
train(8,13,1502.985023).
train(8,14,1524.582227).
train(8,15,1550.105555).
train(8,16,1580.26873).
train(8,17,1615.915223).
train(8,18,1658.041838).
train(8,19,1707.826587).
train(8,20,1658.041838).
train(8,21,1615.915223).
train(8,22,1580.26873).
train(8,23,1550.105555).
train(8,24,1524.582227).
train(8,25,1502.985023).
train(8,26,1484.710006).
train(8,27,1469.246141).
train(8,28,1456.161004).
train(8,29,1445.088686).
train(8,30,1435.719567).
train(9,1,686.1696004).
train(9,2,686.2652466).
train(9,3,686.3875919).
train(9,4,686.5440893).
train(9,5,686.7442722).
train(9,6,687.0003351).
train(9,7,687.3278767).
train(9,8,687.74685).
train(9,9,688.2827774).
train(9,10,688.9683064).
train(9,11,689.8451973).
train(9,12,690.9668679).
train(9,13,692.4016473).
train(9,14,694.2369381).
train(9,15,696.5845411).
train(9,16,699.5874658).
train(9,17,703.4286418).
train(9,18,708.3420628).
train(9,19,714.6270407).
train(9,20,722.6664387).
train(9,21,732.9499943).
train(9,22,746.1041529).
train(9,23,762.9302289).
train(9,24,746.1041529).
train(9,25,732.9499943).
train(9,26,722.6664387).
train(9,27,714.6270407).
train(9,28,708.3420628).
train(9,29,703.4286418).
train(9,30,699.5874658).
train(10,1,6102.338259).
train(10,2,6102.343167).
train(10,3,6102.349109).
train(10,4,6102.356303).
train(10,5,6102.365013).
train(10,6,6102.37556).
train(10,7,6102.388329).
train(10,8,6102.403789).
train(10,9,6102.422507).
train(10,10,6102.44517).
train(10,11,6102.47261).
train(10,12,6102.505832).
train(10,13,6102.546057).
train(10,14,6102.594759).
train(10,15,6102.653725).
train(10,16,6102.725119).
train(10,17,6102.81156).
train(10,18,6102.916218).
train(10,19,6103.042933).
train(10,20,6103.196355).
train(10,21,6103.382111).
train(10,22,6103.607015).
train(10,23,6103.87932).
train(10,24,6104.209014).
train(10,25,6104.608194).
train(10,26,6105.091502).
train(10,27,6105.67667).
train(10,28,6106.385166).
train(10,29,6107.24298).
train(10,30,6108.281584).


labels(1,0).
labels(2,1).
labels(3,1).
labels(4,1).
labels(5,0).
labels(6,1).
labels(7,1).
labels(8,1).
labels(9,1).
labels(10,1).


test(1,1,1041.990593).
test(1,2,1039.850024).
test(1,3,1037.136237).
test(1,4,1033.695733).
test(1,5,1029.333904).
test(1,6,1023.804033).
test(1,7,1016.793331).
test(1,8,1007.905251).
test(1,9,996.6370553).
test(1,10,982.3513778).
test(1,11,964.240175).
test(1,12,941.2790193).
test(1,13,964.240175).
test(1,14,982.3513778).
test(1,15,996.6370553).
test(1,16,1007.905251).
test(1,17,1016.793331).
test(1,18,1023.804033).
test(1,19,1029.333904).
test(1,20,1033.695733).
test(1,21,1037.136237).
test(1,22,1039.850024).
test(1,23,1041.990593).
test(1,24,1043.679022).
test(1,25,1045.010814).
test(1,26,1046.061299).
test(1,27,1046.889896).
test(1,28,1047.543473).
test(1,29,1048.058999).
test(1,30,1048.465633).


% Schema
database({
train(Id:integer,Col:integer,Val:float),
labels(Id: integer, Class:integer),
test(Id:integer,Col:integer,Val:float)
}).

%Rules
squares(Id,Tid,Col,C) <- test(Id,Col,V1),train(Tid,Col,V2),C=(V1-V2)*(V1-V2).
sumsq(Id,Tid,sum<C>) <- squares(Id,Tid,Col,C).
msumsq(Id,Tid) <- sg(Id),sumsq(Id,Tid,C).

btw(Id,Tid1,Tid3) <- msumsq(Id,Tid1),msumsq(Id,Tid2),msumsq(Id,Tid3),sumsq(Id,Tid1,V1),sumsq(Id,Tid2,V2),sumsq(Id,Tid3,V3),V1<V2,V2<V3.
smaller(Id,Tid) <- sumsq(Id,Tid,V),sumsq(Id,Tid1,V1),V1<V.
topk(Id,Tid,V,1) <- sumsq(Id,Tid,V),~smaller(Id,Tid).
topk(Id,Tid2,V2,K1) <- topk(Id,Tid1,V1,K),sumsq(Id,Tid2,V2),V2>V1,~btw(Id,Tid1,Tid2),K1=K+1.

finaltopk(Id,Tid,1) <- msumsq(Id,Tid),~smaller(Id,Tid).
finaltopk(Id,Tid2,K1) <- sumsq(Id,Tid1,V1),sumsq(Id,Tid2,V2),finaltopk(Id,Tid1,K),V2>V1,~btw(Id,Tid1,Tid2),K1=K+1,K1<=5.

sg(1).
topklabels(Id,Tid,L) <- finaltopk(Id,Tid,C),labels(Tid,L).

%selecting majority class
countlabels(Id,L,count<Tid>) <- topklabels(Id,Tid,L). 
maxcount(Id,max<C>) <- countlabels(Id,L,C).

predicted(Id,L) <- countlabels(Id,L,C1),maxcount(Id,C2),C1=C2.


% queries to execute
%query sumsq(1,B,C).
%query topk(A,B,C,D).
%query finaltopk(A,B,C).
query topklabels(A,B,C).
query countlabels(A,B,C).
%query maxcount(B,C).
query predicted(A,B).
